"use strict";(self.webpackChunklukso_docs=self.webpackChunklukso_docs||[]).push([[1083],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),c=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(o.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=c(n),m=r,h=u["".concat(o,".").concat(m)]||u[m]||p[m]||i;return n?a.createElement(h,s(s({ref:t},d),{},{components:n})):a.createElement(h,s({ref:t},d))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=u;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:r,s[1]=l;for(var c=2;c<i;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},6221:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const i={sidebar_label:"LSP1 - Universal Receiver Delegate",sidebar_position:2},s="LSP1 - Universal Receiver Delegate",l={unversionedId:"standards/generic-standards/lsp1-universal-receiver-delegate",id:"standards/generic-standards/lsp1-universal-receiver-delegate",title:"LSP1 - Universal Receiver Delegate",description:"LSP1 - Universal Receiver Delegate",source:"@site/docs/standards/generic-standards/lsp1-universal-receiver-delegate.md",sourceDirName:"standards/generic-standards",slug:"/standards/generic-standards/lsp1-universal-receiver-delegate",permalink:"/standards/generic-standards/lsp1-universal-receiver-delegate",draft:!1,editUrl:"https://github.com/lukso-network/docs/tree/main/docs/standards/generic-standards/lsp1-universal-receiver-delegate.md",tags:[],version:"current",lastUpdatedAt:1687777629,formattedLastUpdatedAt:"Jun 26, 2023",sidebarPosition:2,frontMatter:{sidebar_label:"LSP1 - Universal Receiver Delegate",sidebar_position:2},sidebar:"standardsSidebar",previous:{title:"LSP1 - Universal Receiver",permalink:"/standards/generic-standards/lsp1-universal-receiver"},next:{title:"LSP14 - Ownable 2-Step",permalink:"/standards/generic-standards/lsp14-ownable-2-step"}},o={},c=[{value:"Introduction",id:"introduction",level:2},{value:"What does this standard represent ?",id:"what-does-this-standard-represent-",level:2},{value:"Specification",id:"specification",level:3},{value:"How Delegation works",id:"how-delegation-works",level:3},{value:"Implementations",id:"implementations",level:2},{value:"Token transfer scenario",id:"token-transfer-scenario",level:3},{value:"References",id:"references",level:2}],d={toc:c};function p(e){let{components:t,...i}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"lsp1---universal-receiver-delegate"},"LSP1 - Universal Receiver Delegate"),(0,r.kt)("admonition",{title:"Standard Document",type:"info"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-1-UniversalReceiver.md#specification-of-the-universalreceiverdelegate"},"LSP1 - Universal Receiver Delegate"))),(0,r.kt)("admonition",{title:"Recommendation",type:"success"},(0,r.kt)("p",{parentName:"admonition"},"To better understand this standard, it is well-advised first to check the origin standard ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/standards/generic-standards/lsp1-universal-receiver"},"LSP1-UniversalReceiver")),".")),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"Once deployed, the code of a smart contract ",(0,r.kt)("strong",{parentName:"p"},"can not be changed"),". However, builders can decide how their smart contracts implement the ",(0,r.kt)("a",{parentName:"p",href:"/standards/smart-contracts/lsp0-erc725-account#universalreceiver"},(0,r.kt)("inlineCode",{parentName:"a"},"universalReceiver(...)"))," function."),(0,r.kt)("p",null,"Therefore, it is advised not to hardcode how the smart contract should handle and react to specific calls inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function. Instead, it should delegate this functionality to another external contract. Developers could then customize such contracts to implement a specific logic, that is ",(0,r.kt)("strong",{parentName:"p"},"changeable anytime")," by updating the reference to a new contract in the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(..)")," function."),(0,r.kt)("h2",{id:"what-does-this-standard-represent-"},"What does this standard represent ?"),(0,r.kt)("h3",{id:"specification"},"Specification"),(0,r.kt)("admonition",{title:"recommendation",type:"success"},(0,r.kt)("p",{parentName:"admonition"},"Smart contracts implementing the ",(0,r.kt)("a",{parentName:"p",href:"#"},"LSP1-UniversalReceiverDelegate")," standard SHOULD ",(0,r.kt)("strong",{parentName:"p"},"register")," the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/contracts/interface-ids"},"LSP1UniversalReceiver InterfaceId")," using ERC165"),". This way, other contracts can be aware that the contract supports the LSP1 standard.")),(0,r.kt)("p",null,"This standard defines a contract called ",(0,r.kt)("strong",{parentName:"p"},"UniversalReceiverDelegate")," containing a single function named ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," that should be called by the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(..)")," function with:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"bytes32 ",(0,r.kt)("inlineCode",{parentName:"p"},"typeId"),": the typeId passed to the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"bytes ",(0,r.kt)("inlineCode",{parentName:"p"},"data"),": the data passed to the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function."))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"NB: It is possible to send extra calldata from the main ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(..)")," function to the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(..)")," function on the UniversalReceiverDelegate.")),(0,r.kt)("h3",{id:"how-delegation-works"},"How Delegation works"),(0,r.kt)("p",null,"Delegation in the context of smart contracts implementing the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function allows for flexibility in handling specific calls without hardcoding the logic within the primary contract. While the exact implementation of delegation is up to the individual contract, there are some common steps involved in the process."),(0,r.kt)("p",null,"1- Query the ",(0,r.kt)("strong",{parentName:"p"},"UniversalReceiverDelegate")," address: Typically, the address of the ",(0,r.kt)("strong",{parentName:"p"},"UniversalReceiverDelegate")," contract is stored in the primary contract's storage. When the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function is called, the address is retrieved to facilitate delegation."),(0,r.kt)("p",null,"2- Check for LSP1 support: Before making any calls to the UniversalReceiverDelegate contract, it's essential to ensure that the contract supports the LSP1 standard. This can be done by checking for the ",(0,r.kt)("strong",{parentName:"p"},"LSP1UniversalReceiver InterfaceId")," using ERC165."),(0,r.kt)("p",null,"3- Call the UniversalReceiverDelegate's ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(..)")," function: Once LSP1 support is confirmed, the primary contract's ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function can delegate the call to the UniversalReceiverDelegate's ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function. This allows the primary contract to utilize the logic implemented in the delegate contract."),(0,r.kt)("p",null,"Delegation can be implemented in various ways, depending on the developer's requirements. Some possible delegation strategies include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Single delegation: The primary contract delegates all calls to a single UniversalReceiverDelegate contract.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Multiple delegation: Different calls are delegated to different UniversalReceiverDelegate contracts based on specific conditions, such as the typeId.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Mixed delegation: A combination of single and multiple delegation strategies can be used, where some calls are delegated to a single contract, while others are delegated to different contracts based on specific conditions."))),(0,r.kt)("p",null,"In summary, delegation provides a flexible way for smart contracts to handle and react to specific calls, allowing developers to update the logic without altering the primary contract's code. This approach is particularly useful when working with the universalReceiver(...) function and implementing the LSP1 standard."),(0,r.kt)("h2",{id:"implementations"},"Implementations"),(0,r.kt)("p",null,"There are several implementations of the standard. The ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/standards/smart-contracts/lsp1-universal-receiver-delegate-up"},"LSP1UniversalReceiverDelegateUP"))," contract is one of them and is used as a delegate to the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function of ",(0,r.kt)("strong",{parentName:"p"},"UniversalProfile")," contract."),(0,r.kt)("p",null,"At the moment, this contract allows to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"receive and send tokens & vaults"),(0,r.kt)("li",{parentName:"ul"},"register the data keys representing them according to ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("a",{parentName:"strong",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-5-ReceivedAssets.md"},"LSP5-ReceivedAssets"))," and ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("a",{parentName:"strong",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-10-ReceivedVaults.md"},"LSP10-ReceivedVaults"))," Standards.")),(0,r.kt)("h3",{id:"token-transfer-scenario"},"Token transfer scenario"),(0,r.kt)("p",null,"One of the possible scenarios is a token transfer between Alice and Bob. Alice wants to transfer a token owned by her Universal Profile to the Universal Profile of her friend Bob."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1.")," It calls the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"transfer(...)"))," function on the token contract."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"executing transfer function",src:n(2995).Z,width:"1489",height:"671"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"2.")," The ",(0,r.kt)("inlineCode",{parentName:"p"},"transfer(...)")," function on the token contract will directly ",(0,r.kt)("strong",{parentName:"p"},"trigger a hook")," that will call the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function on both sender and recipient Universal Profiles."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"token contract hooks calling universalReceiver function",src:n(3563).Z,width:"1589",height:"629"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3.")," 3. If the ",(0,r.kt)("strong",{parentName:"p"},"UniversalReceiverDelegate")," contract is set, it will be called by the ",(0,r.kt)("inlineCode",{parentName:"p"},"universalReceiver(...)")," function and will execute its custom logic."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"universalReceiver function calling UniversalReceiverDelegate contract",src:n(5394).Z,width:"1323",height:"755"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"4.")," The ",(0,r.kt)("strong",{parentName:"p"},"UniversalReceiverDelegate")," of ",(0,r.kt)("strong",{parentName:"p"},"Universal Profile")," allows the transfer and set ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-5-ReceivedAssets.md"},"LSP5-ReceivedAssets"))," data keys on both Profiles."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"UniversalReceiverDelegate setting data keys on profile",src:n(8912).Z,width:"1261",height:"792"})),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"For the UniversalReceiverDelegate to be able to call setData function on the UniversalProfile, it should be allowed by the logic of the owner through LSP20.")),(0,r.kt)("h2",{id:"references"},"References"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-1-UniversalReceiver.md"},"LUKSO Standards Proposals: LSP1 - Universal Receiver (Standard Specification, GitHub)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/lukso-network/lsp-universalprofile-smart-contracts/tree/develop/contracts/LSP1UniversalReceiver"},"LSP1 Universal Receiver: Solidity implementations (GitHub)"))))}p.isMDXComponent=!0},2995:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/token-transfer-1-292b7a5662f9bf23e857ca1e59d30b2a.jpeg"},3563:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/token-transfer-2-fb86344d86b78fe3521a377bc1f483a6.jpeg"},5394:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/token-transfer-3-52864ea40875fc14675bb5334563f043.jpeg"},8912:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/token-transfer-4-8cf627cf6bf721fc68d2601d94b0d4f7.jpeg"}}]);